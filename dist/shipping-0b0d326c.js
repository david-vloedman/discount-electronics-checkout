(window.webpackJsonpCheckout=window.webpackJsonpCheckout||[]).push([[15],{1816:function(e,t,n){"use strict";var i=n(18),s=n(0),a=Object(s.createContext)({onToggle:i.noop});t.a=a},1827:function(e,t,n){"use strict";n.d(t,"a",(function(){return u}));var i=n(2),s=n(18),a=n(0),r=n.n(a),o=n(1863),d=n(94),c=n(1816),l=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state={},t.getContextValue=Object(d.memoizeOne)((function(e){return{onToggle:t.handleToggleItem,selectedItemId:e}})),t.handleToggleItem=function(e){var n=t.props,i=n.isDisabled,a=n.onSelect,r=void 0===a?s.noop:a;i||(t.setState({selectedItemId:e}),r(e))},t}return Object(i.__extends)(t,e),t.prototype.render=function(){var e=this.props,t=e.children,n=e.className,i=void 0===n?"accordion":n,s=e.defaultSelectedItemId,a=this.state.selectedItemId,o=void 0===a?s:a;return r.a.createElement(c.a.Provider,{value:this.getContextValue(o)},r.a.createElement("ul",{className:i},t))},t}(a.Component),u=Object(a.createContext)(void 0);t.b=Object(o.a)(Object(a.memo)((function(e){var t=e.formik.setFieldValue,n=e.name,o=e.onSelect,d=void 0===o?s.noop:o,c=Object(i.__rest)(e,["formik","name","onSelect"]),p=Object(a.useCallback)((function(e){t(n,e),d(e)}),[n,d,t]),h=Object(a.useMemo)((function(){return{name:n}}),[n]);return r.a.createElement(u.Provider,{value:h},r.a.createElement(l,Object(i.__assign)({},c,{className:"form-checklist optimizedCheckout-form-checklist",onSelect:p})))})))},1838:function(e,t,n){"use strict";function i(e){var t=document.createElement("div");t.innerHTML=e;var n=t.querySelector("a");if(!n)return[];var i=t.innerHTML.split(n.outerHTML);return[i[0],n.text,i[1]]}n.d(t,"a",(function(){return i}))},1859:function(e,t,n){"use strict";var i=n(0),s=n.n(i),a=n(1761),r=n(1838),o=n(328);t.a=Object(o.a)((function(e){var t=e.data,n=e.id,i=e.language,o=e.onClick,d=e.testId,c=i.translate(n,t),l=Object(r.a)(c);return l.length?s.a.createElement(s.a.Fragment,null,l[0],s.a.createElement("a",{"data-test":d,href:"#",onClick:Object(a.a)(o)},l[1]),l[2]):s.a.createElement(s.a.Fragment,null,c)}))},1863:function(e,t,n){"use strict";n.d(t,"a",(function(){return c}));var i=n(2),s=n(122),a=n(0),r=n.n(a),o=n(101),d=n.n(o);function c(e){var t=Object(a.memo)((function(t){return r.a.createElement(e,Object(i.__assign)({},t))}),(function(e,t){var n=e.formik,s=Object(i.__rest)(e,["formik"]),a=t.formik,r=Object(i.__rest)(t,["formik"]);return d()(n,a)&&d()(s,r)})),n=Object(s.connect)(t);return n.displayName="ConnectFormik("+(e.displayName||e.name)+")",n}},1865:function(e,t,n){},1866:function(e,t,n){},1869:function(e,t,n){"use strict";var i=n(2),s=n(94),a=n(18),r=n(0),o=n.n(r),d=n(41),c=n.n(d),l=n(511),u=n(1816),p=Object(r.memo)((function(e){var t,n,i=e.bodyClassName,s=void 0===i?"accordion-item-body":i,a=e.children,d=e.className,p=void 0===d?"accordion-item":d,h=e.classNameSelected,g=void 0===h?"accordion-item--selected":h,m=e.headerClassName,f=void 0===m?"accordion-item-header":m,S=e.headerClassNameSelected,b=void 0===S?"accordion-item-header--selected":S,O=e.headerContent,v=e.itemId,y=Object(r.useContext)(u.a),_=y.onToggle,C=y.selectedItemId===v,A=Object(r.useCallback)((function(e,t){e.addEventListener("transitionend",(function(n){n.target===e&&t()}))}),[]);return o.a.createElement("li",{className:c()(p,(t={},t[g]=C,t))},o.a.createElement("div",{className:c()(f,(n={},n[b]=C,n))},O({isSelected:C,onToggle:_})),a&&o.a.createElement(l.CSSTransition,{addEndListener:A,classNames:s,in:C,mountOnEnter:!0,timeout:{},unmountOnExit:!0},o.a.createElement("div",{className:s},a)))})),h=n(513),g=n(1827),m=n(508),f=n(506),S=function(e){var t=e.id,n=e.isSelected,s=e.children,a=Object(i.__rest)(e,["id","isSelected","children"]);return o.a.createElement(o.a.Fragment,null,o.a.createElement(m.a,Object(i.__assign)({},a,{checked:n,className:"form-checklist-checkbox optimizedCheckout-form-checklist-checkbox",id:t,type:"radio"})),o.a.createElement(f.a,{htmlFor:t},s))};t.a=Object(r.memo)((function(e){var t=e.isDisabled,n=e.value,d=e.content,c=e.htmlId,l=void 0===c?Object(a.kebabCase)(n):c,u=e.label,m=Object(i.__rest)(e,["isDisabled","value","content","htmlId","label"]),f=(Object(r.useContext)(g.a)||{}).name,b=void 0===f?"":f,O=Object(r.useCallback)(Object(s.memoizeOne)((function(e){return function(s){var a=s.field;return o.a.createElement(S,Object(i.__assign)({},a,{disabled:t,id:l,isSelected:a.value===n,value:n}),u instanceof Function?u(e):u)}})),[l,t,u,n]),v=Object(r.useCallback)(Object(s.memoizeOne)((function(e){return function(t){n===t&&e(n)}})),[]),y=Object(r.useCallback)((function(e){var t=e.isSelected,n=e.onToggle;return o.a.createElement(h.a,{className:"form-checklist-option",name:b,onChange:v(n),render:O(t)})}),[v,b,O]);return o.a.createElement(p,Object(i.__assign)({},m,{bodyClassName:"form-checklist-body",className:"form-checklist-item optimizedCheckout-form-checklist-item",classNameSelected:"form-checklist-item--selected optimizedCheckout-form-checklist-item--selected",headerClassName:"form-checklist-header",headerClassNameSelected:"form-checklist-header--selected",headerContent:y,itemId:n}),d)}))},1885:function(e,t,n){"use strict";n.r(t),n.d(t,"mapToShippingProps",(function(){return Le}));var i=n(2),s=n(18),a=n(0),r=n.n(a),o=n(129),d=n(1878),c=n(1830),l=n(502),u=n(1764),p=n(1791),h=n(1785),g=n(837),m=n(354),f=function(e){function t(n){var i=e.call(this,{name:"UNASSIGN_ITEM_FAILED",message:Object(m.a)().translate("shipping.unassign_item_error"),data:n})||this;return Object(h.a)(i,t.prototype),i}return Object(i.__extends)(t,e),t}(g.a),S=n(1833),b=n(1881);function O(e){var t=Object(b.a)(e);return t&&["amazon","amazonpay"].indexOf(t.providerId)>-1?t.providerId:void 0}var v=n(328),y=n(122),_=n(692),C=n(73),A=n(1761),E=n(503),j=n(1790),k=n(1800),D=n(1776),I=n(1788),M=n(834),w=n(1867),F=Object(v.a)(Object(y.withFormik)({handleSubmit:function(e,t){(0,t.props.onSaveAddress)(e)},mapPropsToValues:function(e){var t=e.defaultCountryCode;return{firstName:"",lastName:"",address1:"",address2:"",customFields:{},country:"",countryCode:void 0===t?"":t,stateOrProvince:"",stateOrProvinceCode:"",postalCode:"",phone:"",city:"",company:"",shouldSaveAddress:!1}},validationSchema:function(e){var t=e.language,n=e.getFields;return Object(C.lazy)((function(e){return Object(M.a)({language:t,formFields:n(e&&e.countryCode)})}))}})((function(e){var t=e.googleMapsApiKey,n=e.getFields,i=e.countriesWithAutocomplete,s=e.countries,a=e.values,o=e.setFieldValue,d=e.isLoading,c=e.onRequestClose;return r.a.createElement(k.a,{autoComplete:"on"},r.a.createElement(p.a,{isLoading:d},r.a.createElement(w.a,{countries:s,countriesWithAutocomplete:i,countryCode:a.countryCode,formFields:n(a.countryCode),googleMapsApiKey:t,setFieldValue:o,shouldShowSaveAddress:!1,isPickupOnly:!1}),r.a.createElement("div",{className:"form-actions"},r.a.createElement("a",{className:"button optimizedCheckout-buttonSecondary",href:"#",onClick:Object(A.a)(c)},r.a.createElement(E.a,{id:"common.cancel_action"})),r.a.createElement(j.c,{disabled:d,id:"checkout-save-address",type:"submit",variant:j.b.Primary},r.a.createElement(E.a,{id:"address.save_address_action"})))))}))),N=function(e){var t=e.isOpen,n=e.onAfterOpen,s=e.onRequestClose,a=Object(i.__rest)(e,["isOpen","onAfterOpen","onRequestClose"]);return r.a.createElement(D.a,{additionalModalClassName:"modal--medium",header:r.a.createElement(I.a,null,r.a.createElement(E.a,{id:"address.add_address_heading"})),isOpen:t,onAfterOpen:n,onRequestClose:s,shouldShowCloseButton:!0},r.a.createElement(F,Object(i.__assign)({},a,{onRequestClose:s})))},P=n(1804),z=n(1859),B=function(e){function t(n){var i=e.call(this,{name:"ASSIGN_ITEM_INVALID_ADDRESS",message:Object(m.a)().translate("shipping.assign_item_invalid_address_error"),title:Object(m.a)().translate("shipping.assign_item_invalid_address_error_heading"),data:n})||this;return Object(h.a)(i,t.prototype),i}return Object(i.__extends)(t,e),t}(g.a),U=function(e){function t(n){var i=e.call(this,{name:"ASSIGN_ITEM_FAILED",message:Object(m.a)().translate("shipping.assign_item_error"),data:n})||this;return Object(h.a)(i,t.prototype),i}return Object(i.__extends)(t,e),t}(g.a);function L(e,t){return Object(s.find)(e,(function(e){return Object(s.includes)(e.lineItemIds,t)}))}function x(e,t){return Object(s.reduce)(e&&e.lineItems.physicalItems||[],(function(e,n,a){return!n.addedByPromotion&&Object(s.isNil)(n.parentId)?e.concat.apply(e,function(e,t,n){for(var s=[],a=L(t,e.id),r=0;r<e.quantity;r++)s=s.concat(Object(i.__assign)(Object(i.__assign)({},e),{key:e.variantId+"-"+e.productId+"-"+n+"-"+r,consignment:a,quantity:1}));return s}(n,t,a)):e}),[])}var G=n(1771),T=n(688);var R=n(1880),V=Object(a.memo)((function(e){var t=e.item,n=t.id,i=t.key,s=t.imageUrl,o=t.quantity,d=t.name,c=t.options,l=t.consignment,u=e.addresses,p=e.onSelectAddress,h=e.onUseNewAddress,g=Object(a.useCallback)((function(e){h(e,n,i)}),[n,h,i]),m=Object(a.useCallback)((function(e){p(e,n,i)}),[n,i,p]);return r.a.createElement("div",{className:"consignment"},r.a.createElement("figure",{className:"consignment-product-figure"},s&&r.a.createElement("img",{alt:d,src:s})),r.a.createElement("div",{className:"consignment-product-body"},r.a.createElement("h5",{className:"optimizedCheckout-contentPrimary"},o+" x "+d),(c||[]).map((function(e){var t=e.name,n=e.value,i=e.nameId;return r.a.createElement("ul",{className:"product-options optimizedCheckout-contentSecondary","data-test":"consigment-item-product-options",key:i},r.a.createElement("li",{className:"product-option"},t+" "+n))})),r.a.createElement(R.a,{addresses:u,onSelectAddress:m,onUseNewAddress:g,selectedAddress:l&&l.shippingAddress})))})),q=n(506),W=n(1773),H=n(1799),K=n(1798),Z=n(1774),J=n(731);var Q=Object(l.a)((function(e){return{order:(0,e.checkoutState.data.getOrder)()}}))((function(e){var t=e.onDatePicked,n=e.hasGiftOption,s=e.toggleGiftOption,o=e.setShipByDate,d=e.isDate,c=e.heading,l=e.isPickupOnly,u=e.shipByDate,p=Object(a.useRef)(null),h=Object(a.useRef)(null),g=Object(a.useMemo)((function(){return r.a.createElement(r.a.Fragment,null,r.a.createElement("label",{htmlFor:"gift",className:"form-label optimizedCheckout-form-label"},"This is a gift"),r.a.createElement("p",{className:"ob-giftOption__message"},"(We Offer Complimentary Greeting Cards)"))}),[]),m=Object(a.useMemo)((function(){return r.a.createElement("p",{className:"ob-orderComments__message"},"(Limit 150 Characters, 3 Lines)")}),[]),f=Object(a.useCallback)((function(e){return r.a.createElement(q.a,{hidden:!0,htmlFor:e},r.a.createElement(E.a,{id:"shipping.order_comment_label"}))}),[]),S=Object(a.useCallback)((function(e){var t=e.field;return r.a.createElement(W.a,Object(i.__assign)({},t,{autoComplete:"off",maxLength:150,placeholder:"Add your message here",ref:h}))}),[]),b=Object(a.useMemo)((function(){return r.a.createElement(H.a,null,r.a.createElement(E.a,{id:"shipping.order_comment_label"}))}),[]);return r.a.createElement(r.a.Fragment,null,r.a.createElement((function(){return r.a.createElement("div",{className:"ob-giftOption"},r.a.createElement("input",{id:"gift",className:"ob-giftOption__checkbox form-checkbox optimizedCheckout-form-checkbox",type:"checkbox",ref:p,checked:n,value:""+n,onChange:function(){return s()}}),g)}),null),r.a.createElement(J.a,{onDatePicked:t,setShipByDate:o,isDate:d,heading:c,isPickupOnly:l,shipByDate:u}),r.a.createElement(K.a,{legend:b,testId:"checkout-shipping-comments"},r.a.createElement(Z.a,{input:S,label:f,name:"orderComment"}),m))})),X=n(1803),Y=n(1759);var $=n(835),ee=(n(1865),n(1869)),te=n(1827),ne=n(1779),ie=function(e){var t=e.consignmentId,n=e.shippingOption,i=Object(a.useCallback)((function(){return r.a.createElement("div",{className:"shippingOptionLabel"},r.a.createElement(ne.a,{displayAdditionalInformation:!0,method:n}))}),[n]);return r.a.createElement(ee.a,{htmlId:"shippingOptionRadio-"+t+"-"+n.id,label:i,value:n.id})},se=Object(a.memo)((function(e){var t=e.consignmentId,n=e.inputName,i=e.isLoading,s=e.shippingOptions,o=void 0===s?u.a:s,d=e.selectedShippingOptionId,c=e.onSelectedOption,l=e.isMessengerDelivery,h=e.isShippingOnly,g=Object(a.useCallback)((function(e){c(t,e)}),[t,c]);return o.length?r.a.createElement(p.a,{isLoading:i},r.a.createElement(te.b,{"aria-live":"polite",defaultSelectedItemId:d,name:n,onSelect:g},o.map((function(e){var n=r.a.createElement(ie,{consignmentId:t,key:e.id,shippingOption:e});return l?e.description.indexOf("Messenger Delivery Service")>-1?n:void 0:h?"shipping_pickupinstore"!==e.type&&-1===e.description.indexOf("Messenger Delivery Service")?n:void 0:n})))):null})),ae=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.checkForShipping=function(){return Object(i.__awaiter)(t,void 0,void 0,(function(){var e,t,n,s,a=this;return Object(i.__generator)(this,(function(r){return this.props.isMessengerDelivery&&(e=document.querySelector("#checkout-shipping-options"),0===(null==(t=null==e?void 0:e.querySelectorAll(".form-checklist-item"))?void 0:t.length)?(null===(n=null==e?void 0:e.querySelector(".shippingOptions-container"))||void 0===n||n.classList.add("tempHide"),null===(s=null==e?void 0:e.querySelector("#messZipError"))||void 0===s||s.classList.remove("tempHide"),null==e||e.classList.remove("tempHide")):(null==t||t.forEach((function(e){return Object(i.__awaiter)(a,void 0,void 0,(function(){var t,n,s,a,r;return Object(i.__generator)(this,(function(i){return(t=null===(r=e.querySelector(".shippingOption-desc"))||void 0===r?void 0:r.textContent)&&t.indexOf("Messenger Delivery Service")>-1&&(n=e.querySelector(".form-checklist-checkbox"))&&(n.checked=!0,s=n.id,a=s.split("-"),this.props.consignments&&(!this.props.consignments[0].selectedShippingOption||this.props.consignments[0].selectedShippingOption&&this.props.consignments[0].selectedShippingOption.id!==a[2])&&this.props.selectShippingOption(a[1],a[2])),[2]}))}))})),null==e||e.classList.add("tempHide"))),[2]}))}))},t.selectDefaultShippingOptions=function(e){var n=e.data;return Object(i.__awaiter)(t,void 0,void 0,(function(){var e,t,s,a,r,o,d,c,l;return Object(i.__generator)(this,(function(i){switch(i.label){case 0:return e=this.props,t=e.selectShippingOption,s=e.setFieldValue,(a=(n.getConsignments()||[]).find((function(e){var t=e.selectedShippingOption,n=e.availableShippingOptions;return!t&&n})))&&a.availableShippingOptions?(r=a.availableShippingOptions,o=a.id,d=function(e){if(e)return e.find((function(e){return e.isRecommended}))}(r),c=1===r.length&&r[0],(l=d||c)?[4,t(o,l.id)]:[2]):[2];case 1:return i.sent(),s("shippingOptionIds."+o,l.id),[2]}}))}))},t}return Object(i.__extends)(t,e),t.prototype.componentDidMount=function(){var e=this.props.subscribeToConsignments;this.unsubscribe=e(this.selectDefaultShippingOptions),this.checkForShipping()},t.prototype.componentWillUnmount=function(){this.unsubscribe&&(this.unsubscribe(),this.unsubscribe=void 0)},t.prototype.componentDidUpdate=function(){this.checkForShipping()},t.prototype.render=function(){var e=this,t=this.props,n=t.consignments,i=t.isMultiShippingMode,s=t.selectShippingOption,a=t.isLoading,o=t.shouldShowShippingOptions,d=t.invalidShippingMessage,c=t.methodId,l=t.isMessengerDelivery,u=t.isShippingOnly;return n&&n.length&&o?r.a.createElement(r.a.Fragment,null,n.map((function(t){return r.a.createElement("div",{className:"shippingOptions-container form-fieldset",key:t.id},i&&e.renderConsignment(t),r.a.createElement(se,{consignmentId:t.id,inputName:(n=t.id,"shippingOptionIds."+n),isLoading:a(t.id),onSelectedOption:s,selectedShippingOptionId:t.selectedShippingOption&&t.selectedShippingOption.id,shippingOptions:t.availableShippingOptions,isMessengerDelivery:l,isShippingOnly:u}),(!t.availableShippingOptions||!t.availableShippingOptions.length)&&r.a.createElement(p.a,{hideContentWhenLoading:!0,isLoading:a(t.id)},e.renderNoShippingOptions(d)));var n}))):r.a.createElement(p.a,{isLoading:a()},this.renderNoShippingOptions(r.a.createElement(E.a,{id:c||i?"shipping.select_shipping_address_text":"shipping.enter_shipping_address_text"})))},t.prototype.renderNoShippingOptions=function(e){return r.a.createElement("div",{className:"shippingOptions-panel optimizedCheckout-overlay"},r.a.createElement("p",{className:"shippingOptions-panel-message optimizedCheckout-primaryContent"},e))},t.prototype.renderConsignment=function(e){var t=this.props.cart;return r.a.createElement("div",{className:"staticConsignment"},r.a.createElement("strong",null,r.a.createElement(E.a,{id:"shipping.shipping_address_heading"})),r.a.createElement(Y.a,{address:e.shippingAddress}),r.a.createElement($.a,{cart:t,consignment:e}))},t}(a.PureComponent);var re=Object(y.withFormik)({handleSubmit:s.noop,mapPropsToValues:function(e){var t=e.consignments,n={};return(t||[]).forEach((function(e){n[e.id]=e.selectedShippingOption?e.selectedShippingOption.id:""})),{shippingOptionIds:n}}})(ae),oe=Object(o.createSelector)((function(e){return e.checkoutService.subscribe}),(function(e){return function(t){return e(t,(function(e){return e.data.getConsignments()}))}})),de=Object(o.createSelector)((function(e,t){return t.isUpdatingAddress}),(function(e){return e.statuses.isLoadingShippingOptions}),(function(e){return e.statuses.isSelectingShippingOption}),(function(e){return e.statuses.isUpdatingConsignment}),(function(e){return e.statuses.isCreatingConsignments}),(function(e,t,n,i,s){return function(a){return e||t()||n(a)||i(a)||s()}})),ce=function(e,t){if(t.length<2)return t;var n=x(e,t),i=Object(s.uniq)(Object(s.map)(n,"consignment.id"));return Object(s.sortBy)(t,(function(e){return i.indexOf(e.id)}))};var le=Object(l.a)((function(e,t){var n=e.checkoutService,i=e.checkoutState,s=i.data,a=s.getCart,r=s.getConsignments,o=s.getConfig,d=s.getCustomer,c=s.getCheckout,l=i.statuses.isSelectingShippingOption,u=d(),p=a(),h=o(),g=c();if(!(h&&g&&u&&p))return null;var m=ce(p,r()||[]),f=O(g);return{cart:p,consignments:m,invalidShippingMessage:h.checkoutSettings.shippingQuoteFailedMessage,isLoading:de(i,t),isSelectingShippingOption:l,methodId:f,selectShippingOption:n.selectConsignmentShippingOption,subscribeToConsignments:oe({checkoutService:n,checkoutState:i})}}))(re),ue=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Object(i.__extends)(t,e),t.prototype.render=function(){var e=this.props,t=e.isDatePicked,n=e.onDatePicked,i=e.cartHasChanged,s=e.isMultiShippingMode,a=e.shouldShowOrderComments,o=e.shouldShowShippingOptions,d=void 0===o||o,c=e.shouldDisableSubmit,l=e.isLoading,u=e.isMessengerDelivery,p=e.isShippingOnly,h=e.hasGiftOption,g=e.hasShipByDate,m=e.shipByDate,f=e.toggleGiftOption,S=e.setShipByDate,b=e.isPickupOnly,O=e.customerMessage,v=r.a.createElement(K.a,{id:"checkout-shipping-options",legend:r.a.createElement(r.a.Fragment,null,r.a.createElement(H.a,null,r.a.createElement(E.a,{id:"shipping.shipping_method_label"})),i&&r.a.createElement(X.b,{type:X.a.Error},r.a.createElement("strong",null,r.a.createElement(E.a,{id:"shipping.cart_change_error"})))),className:u?"form-fieldset isMessengerDelivery tempHide":"form-fieldset"},r.a.createElement(le,{isMultiShippingMode:s,isUpdatingAddress:l,shouldShowShippingOptions:d,isMessengerDelivery:u,isShippingOnly:p}),r.a.createElement("p",{id:"messZipError",className:"ob-giftOption__message tempHide"},"No messenger service options for zipcode entered. Please use a different zipcode."));return r.a.createElement(r.a.Fragment,null,!b&&v,a&&r.a.createElement(Q,{onDatePicked:n,hasGiftOption:h,hasShipByDate:g,shipByDate:m,toggleGiftOption:f,setShipByDate:S,isDate:"",heading:"",isPickupOnly:b,customerMessage:O}),r.a.createElement("div",{className:"form-actions"},r.a.createElement(j.c,{disabled:!t||!(b&&!l)&&c,id:"checkout-shipping-continue",isLoading:l,type:"submit",variant:j.b.Primary},r.a.createElement(E.a,{id:"common.continue_action"}))))},t}(a.PureComponent),pe=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state={items:[]},t.handleCloseErrorModal=function(){t.setState({createCustomerAddressError:void 0})},t.handleSaveAddress=function(e){return Object(i.__awaiter)(t,void 0,void 0,(function(){var t,n,s,a;return Object(i.__generator)(this,(function(i){switch(i.label){case 0:return t=this.props.createCustomerAddress,(n=this.state.itemAddingAddress)?(s=Object(d.a)(e),[4,this.handleSelectAddress(s,n.itemId,n.key)]):[2];case 1:i.sent(),i.label=2;case 2:return i.trys.push([2,4,,5]),[4,t(s)];case 3:return i.sent(),[3,5];case 4:return a=i.sent(),this.setState({createCustomerAddressError:a}),[3,5];case 5:return this.setState({itemAddingAddress:void 0}),[2]}}))}))},t.handleUseNewAddress=function(e,n,i){var s=t.props,a=s.onUseNewAddress;s.shouldShowAddAddressInCheckout?t.setState({itemAddingAddress:{key:i,itemId:n}}):a(e,n)},t.handleCloseAddAddressForm=function(){t.setState({itemAddingAddress:void 0})},t.handleSelectAddress=function(e,n,s){return Object(i.__awaiter)(t,void 0,void 0,(function(){var t,a,r,o,d,c;return Object(i.__generator)(this,(function(i){switch(i.label){case 0:if(t=this.props,a=t.assignItem,r=t.onUnhandledError,o=t.getFields,!Object(_.a)(e,o(e.countryCode)))return[2,r(new B)];i.label=1;case 1:return i.trys.push([1,3,,4]),[4,a({shippingAddress:e,lineItems:[{itemId:n,quantity:1}]})];case 2:return d=i.sent().data,this.syncItems(s,e,d),[3,4];case 3:return c=i.sent(),r(new U(c)),[3,4];case 4:return[2]}}))}))},t.shouldDisableSubmit=function(){var e=t.props,n=e.isLoading,i=e.consignments,s=e.isDatePicked;return n||!Object(G.a)(i)||!s},t.syncItems=function(e,n,s){var a=t.state.items,r=function(e,t,n){var s=t.updatedItemIndex,a=t.address,r=n.cart,o=n.consignments;if(!(s<0||s>=e.length)&&r){var d=r.lineItems.physicalItems.map((function(e){return e.id})),l=(o||[]).find((function(e){return Object(c.a)(e.shippingAddress,a)})),u=function(e,t,n){if(!t||!n)return;var i=t.lineItems.physicalItems.filter((function(t){var n=t.productId,i=t.variantId;return n===e.productId&&i===e.variantId})).map((function(e){return e.id}));return n.lineItemIds.find((function(e){return i.includes(e)}))}(e[s],r,l);return e.map((function(e,t){if(u&&!d.includes(e.id)||t===s){var n=null!=u?u:e.id;return Object(i.__assign)(Object(i.__assign)({},e),{id:n,consignment:L(o||[],n)})}return e}))}}(a,{updatedItemIndex:a.findIndex((function(t){return t.key===e})),address:n},{cart:s.getCart(),consignments:s.getConsignments()});r&&t.setState({items:r})},t}return Object(i.__extends)(t,e),t.getDerivedStateFromProps=function(e,t){var n=e.cart,i=e.consignments;return t&&t.items&&Object(S.a)(n)===t.items.length?null:{items:x(n,i)}},t.prototype.render=function(){var e=this,t=this.props,n=t.isDatePicked,i=t.onDatePicked,s=t.addresses,o=t.consignments,d=t.cart,c=t.isGuest,l=t.onSignIn,u=t.onCreateAccount,p=t.cartHasChanged,h=t.shouldShowOrderComments,g=t.isLoading,m=t.getFields,f=t.defaultCountryCode,S=t.countries,b=t.countriesWithAutocomplete,O=t.googleMapsApiKey,v=t.isMessengerDelivery,y=t.isShippingOnly,_=t.hasGiftOption,C=t.hasShipByDate,j=t.shipByDate,D=t.toggleGiftOption,I=t.setShipByDate,M=t.isPickupOnly,w=t.customerMessage,F=this.state,B=F.items,U=F.itemAddingAddress,L=F.createCustomerAddressError;return c?r.a.createElement("div",{className:"checkout-step-info"},r.a.createElement(E.a,{id:"shipping.multishipping_guest_intro"})," ",r.a.createElement("a",{"data-test":"shipping-sign-in-link",href:"#",onClick:Object(A.a)(l)},r.a.createElement(E.a,{id:"shipping.multishipping_guest_sign_in"}))," ",r.a.createElement(z.a,{id:"shipping.multishipping_guest_create",onClick:u})):r.a.createElement(a.Fragment,null,r.a.createElement(P.a,{error:L,message:r.a.createElement(r.a.Fragment,null,r.a.createElement(E.a,{id:"address.consignment_address_updated_text"})," ",r.a.createElement(E.a,{id:"customer.create_address_error"})),onClose:this.handleCloseErrorModal,shouldShowErrorCode:!1}),r.a.createElement(N,{countries:S,countriesWithAutocomplete:b,defaultCountryCode:f,getFields:m,googleMapsApiKey:O,isLoading:g,isOpen:!!U,onRequestClose:this.handleCloseAddAddressForm,onSaveAddress:this.handleSaveAddress}),r.a.createElement(k.a,null,r.a.createElement("ul",{className:"consignmentList"},B.map((function(t){return r.a.createElement("li",{key:t.key},r.a.createElement(V,{addresses:s,item:t,onSelectAddress:e.handleSelectAddress,onUseNewAddress:e.handleUseNewAddress}))}))),r.a.createElement(ue,{isDatePicked:n,onDatePicked:i,cartHasChanged:p,isLoading:g,isMultiShippingMode:!0,shouldDisableSubmit:this.shouldDisableSubmit(),shouldShowOrderComments:h,shouldShowShippingOptions:!Object(T.a)(o,d.lineItems),isMessengerDelivery:v,isShippingOnly:y,hasGiftOption:_,hasShipByDate:C,shipByDate:j,toggleGiftOption:D,setShipByDate:I,isPickupOnly:M,customerMessage:w})))},t}(a.PureComponent),he=Object(v.a)(Object(y.withFormik)({handleSubmit:function(e,t){(0,t.props.onSubmit)(e)},mapPropsToValues:function(e){return{orderComment:e.customerMessage}},enableReinitialize:!0})(pe)),ge=n(845),me=n(844),fe=n(198),Se=n(1832),be=Object(a.memo)((function(e){var t=e.onChange,n=Object(a.useMemo)((function(){return r.a.createElement(E.a,{id:"billing.use_shipping_address_label"})}),[]);return r.a.createElement(Se.a,{id:"sameAsBilling",labelContent:n,name:"billingSameAsShipping",onChange:t})})),Oe=n(94),ve=n(1868),ye=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.handleFieldValueChange=function(e){return function(n){(0,t.props.onFieldChange)(e,n)}},t}return Object(i.__extends)(t,e),t.prototype.componentDidMount=function(){return Object(i.__awaiter)(this,void 0,void 0,(function(){var e,t,n,a,r,o;return Object(i.__generator)(this,(function(i){switch(i.label){case 0:e=this.props,t=e.initialize,n=e.methodId,a=e.onUnhandledError,r=void 0===a?s.noop:a,i.label=1;case 1:return i.trys.push([1,3,,4]),[4,t({methodId:n})];case 2:return i.sent(),[3,4];case 3:return o=i.sent(),r(o),[3,4];case 4:return[2]}}))}))},t.prototype.componentWillUnmount=function(){return Object(i.__awaiter)(this,void 0,void 0,(function(){var e,t,n,a,r,o;return Object(i.__generator)(this,(function(i){switch(i.label){case 0:e=this.props,t=e.deinitialize,n=e.methodId,a=e.onUnhandledError,r=void 0===a?s.noop:a,i.label=1;case 1:return i.trys.push([1,3,,4]),[4,t({methodId:n})];case 2:return i.sent(),[3,4];case 3:return o=i.sent(),r(o),[3,4];case 4:return[2]}}))}))},t.prototype.render=function(){var e=this,t=this.props,n=t.containerId,i=t.formFields,s=t.methodId;return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"widget address-widget widget--"+s,id:n,tabIndex:-1}),r.a.createElement(K.a,null,i.filter((function(e){return e.custom})).map((function(t){return r.a.createElement(ve.a,{field:t,key:t.id+"-"+t.name,onChange:e.handleFieldValueChange(t.name),parentFieldName:"shippingAddress.customFields",disabled:!1})}))))},t}(a.PureComponent),_e=n(1879),Ce=n(1863),Ae="shippingAddress",Ee=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.setFieldValue=function(e,n){var i=t.props,s=i.formik.setFieldValue,a=i.formFields.filter((function(e){return e.custom})).map((function(e){return e.name})).includes(e)?"customFields."+e:e;s(Ae+"."+a,n)},t.handleChange=function(e,n){(0,t.props.onFieldChange)(e,n)},t.handleAutocompleteToggle=function(e){var n=e.isOpen,i=e.inputValue,s=t.props.onFieldChange;n||s("address1",i)},t}return Object(i.__extends)(t,e),t.prototype.render=function(){var e=this.props,t=e.addresses,n=e.address,i=e.onAddressSelect,s=e.onUseNewAddress,a=e.shouldShowSaveAddress,o=e.countries,d=e.countriesWithAutocomplete,c=e.formFields,l=e.isLoading,u=e.googleMapsApiKey,h=e.formik.values.shippingAddress,g=e.isPickupOnly,m=t&&t.length>0,f=Object(_e.a)(n,t,c);return r.a.createElement(K.a,{id:"checkoutShippingAddress"},!g&&m&&r.a.createElement(K.a,{id:"shippingAddresses"},r.a.createElement(p.a,{isLoading:l},r.a.createElement(R.a,{addresses:t,onSelectAddress:i,onUseNewAddress:s,selectedAddress:f?n:void 0}))),!f&&r.a.createElement(p.a,{isLoading:l,unmountContentWhenLoading:!0},r.a.createElement(w.a,{countries:o,countriesWithAutocomplete:d,countryCode:h&&h.countryCode,fieldName:Ae,formFields:c,googleMapsApiKey:u,onAutocompleteToggle:this.handleAutocompleteToggle,onChange:this.handleChange,setFieldValue:this.setFieldValue,shouldShowSaveAddress:a,isPickupOnly:g})))},t}(a.Component),je=Object(Ce.a)(Ee),ke=(n(1866),function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.handleFieldValueChange=function(e){return function(n){(0,t.props.onFieldChange)(e,n)}},t}return Object(i.__extends)(t,e),t.prototype.componentDidMount=function(){return Object(i.__awaiter)(this,void 0,void 0,(function(){var e,t,n,a,r,o;return Object(i.__generator)(this,(function(i){switch(i.label){case 0:e=this.props,t=e.initialize,n=e.methodId,a=e.onUnhandledError,r=void 0===a?s.noop:a,i.label=1;case 1:return i.trys.push([1,3,,4]),[4,t({methodId:n})];case 2:return i.sent(),[3,4];case 3:return o=i.sent(),r(o),[3,4];case 4:return[2]}}))}))},t.prototype.componentWillUnmount=function(){return Object(i.__awaiter)(this,void 0,void 0,(function(){var e,t,n,a,r,o;return Object(i.__generator)(this,(function(i){switch(i.label){case 0:e=this.props,t=e.deinitialize,n=e.methodId,a=e.onUnhandledError,r=void 0===a?s.noop:a,i.label=1;case 1:return i.trys.push([1,3,,4]),[4,t({methodId:n})];case 2:return i.sent(),[3,4];case 3:return o=i.sent(),r(o),[3,4];case 4:return[2]}}))}))},t.prototype.render=function(){var e=this,t=this.props,n=t.address,i=t.buttonId,s=t.formFields,a=t.isLoading,o=s.filter((function(e){return e.custom})),d=o.length>0;return r.a.createElement(p.a,{isLoading:a},r.a.createElement("div",{className:"stepHeader",style:{padding:0}},r.a.createElement("div",{className:"stepHeader-body subheader"},r.a.createElement(Y.a,{address:n})),r.a.createElement("div",{className:"stepHeader-actions subheader"},r.a.createElement(j.c,{id:i,onClick:Object(A.a)(),size:j.a.Tiny,testId:"step-edit-button",variant:j.b.Secondary},r.a.createElement(E.a,{id:"common.edit_action"})))),d&&r.a.createElement(K.a,{id:"customFieldset"},o.map((function(t){return r.a.createElement(ve.a,{field:t,key:t.id+"-"+t.name,onChange:e.handleFieldValueChange(t.name),parentFieldName:"shippingAddress.customFields",disabled:!1})}))))},t}(a.PureComponent)),De=Object(a.memo)((function(e){var t=e.methodId,n=e.formFields,o=e.countries,d=e.countriesWithAutocomplete,c=e.consignments,l=e.googleMapsApiKey,u=e.onAddressSelect,p=e.onFieldChange,h=e.onUseNewAddress,g=e.initialize,m=e.deinitialize,f=e.isLoading,S=e.shippingAddress,b=e.hasRequestedShippingOptions,O=e.addresses,v=e.shouldShowSaveAddress,y=e.onUnhandledError,_=void 0===y?s.noop:y,C=e.isShippingStepPending,A=e.isMessengerDelivery,E=e.isPickupOnly,j=Object(a.useContext)(fe.a).setSubmitted,k=Object(a.useCallback)(Object(Oe.memoizeOne)((function(e){return function(t){return g(Object(i.__assign)(Object(i.__assign)({},e),t))}})),[]);if(t){var D={};if("amazon"===t)return D={amazon:{container:"addressWidget",onError:_}},r.a.createElement(ye,{containerId:"addressWidget",deinitialize:m,formFields:n,initialize:k(D),methodId:t,onFieldChange:p});if("amazonpay"===t&&S){return D={amazonpay:{editAddressButtonId:"edit-ship-button"}},r.a.createElement(ke,{address:S,buttonId:"edit-ship-button",deinitialize:m,formFields:n,initialize:k(D),isLoading:C,methodId:t,onFieldChange:p})}}return r.a.createElement(je,{address:S,addresses:O,consignments:c,countries:o,countriesWithAutocomplete:d,formFields:n,googleMapsApiKey:l,isLoading:f,onAddressSelect:u,onFieldChange:function(e,t){b&&j(!0),p(e,t)},onUseNewAddress:h,shouldShowSaveAddress:v,isMessengerDelivery:A,isPickupOnly:E})})),Ie=["address1","postalCode","countryCode","city","stateOrProvince","stateOrProvinceCode"],Me=1700,we=function(e){function t(t){var n=e.call(this,t)||this;n.state={isResettingAddress:!1,isUpdatingShippingData:!1,hasRequestedShippingOptions:!1},n.shouldDisableSubmit=function(){var e=n.props,t=e.isLoading,i=e.consignments,s=e.isValid,a=n.state.isUpdatingShippingData;return!!s&&(t||a||!Object(G.a)(i))},n.handleFieldChange=function(e){return Object(i.__awaiter)(n,void 0,void 0,(function(){var t,n,s;return Object(i.__generator)(this,(function(i){switch(i.label){case 0:return t=this.props.setFieldValue,"countryCode"===e&&(t("shippingAddress.stateOrProvince",""),t("shippingAddress.stateOrProvinceCode","")),[4,new Promise((function(e){return setTimeout(e)}))];case 1:return i.sent(),n=Ie.includes(e),s=this.state.hasRequestedShippingOptions,this.props.isValid?(this.updateAddressWithFormData(n||!s),[2]):[2]}}))}))},n.handleAddressSelect=function(e){return Object(i.__awaiter)(n,void 0,void 0,(function(){var t,n,a,r,o,d,c;return Object(i.__generator)(this,(function(l){switch(l.label){case 0:t=this.props,n=t.updateAddress,a=t.onUnhandledError,r=void 0===a?s.noop:a,o=t.values,d=t.setValues,this.setState({isResettingAddress:!0}),l.label=1;case 1:return l.trys.push([1,3,4,5]),[4,n(e)];case 2:return l.sent(),d(Object(i.__assign)(Object(i.__assign)({},o),{shippingAddress:Object(ge.a)(this.getFields(e.countryCode),e)})),[3,5];case 3:return c=l.sent(),r(c),[3,5];case 4:return this.setState({isResettingAddress:!1}),[7];case 5:return[2]}}))}))},n.onUseNewAddress=function(){return Object(i.__awaiter)(n,void 0,void 0,(function(){var e,t,n,a,r,o,d,c;return Object(i.__generator)(this,(function(l){switch(l.label){case 0:e=this.props,t=e.deleteConsignments,n=e.onUnhandledError,a=void 0===n?s.noop:n,r=e.setValues,o=e.values,this.setState({isResettingAddress:!0}),l.label=1;case 1:return l.trys.push([1,3,4,5]),[4,t()];case 2:return d=l.sent(),r(Object(i.__assign)(Object(i.__assign)({},o),{shippingAddress:Object(ge.a)(this.getFields(d&&d.countryCode),d)})),[3,5];case 3:return c=l.sent(),a(c),[3,5];case 4:return this.setState({isResettingAddress:!1}),[7];case 5:return[2]}}))}))};var a=n.props.updateAddress;return n.debouncedUpdateAddress=Object(s.debounce)((function(e,t){return Object(i.__awaiter)(n,void 0,void 0,(function(){return Object(i.__generator)(this,(function(n){switch(n.label){case 0:return n.trys.push([0,,2,3]),[4,a(e,{params:{include:{"consignments.availableShippingOptions":t}}})];case 1:return n.sent(),t&&this.setState({hasRequestedShippingOptions:!0}),[3,3];case 2:return this.setState({isUpdatingShippingData:!1}),[7];case 3:return[2]}}))}))}),Me),n}return Object(i.__extends)(t,e),t.prototype.render=function(){var e=this.props,t=e.isDatePicked,n=e.onDatePicked,i=e.addresses,s=e.cartHasChanged,a=e.isLoading,o=e.onUnhandledError,d=e.methodId,c=e.shouldShowSaveAddress,l=e.countries,u=e.countriesWithAutocomplete,p=e.googleMapsApiKey,h=e.shippingAddress,g=e.consignments,m=e.shouldShowOrderComments,f=e.initialize,S=e.isValid,b=e.deinitialize,O=e.values.shippingAddress,v=e.isShippingStepPending,y=e.isMessengerDelivery,_=e.isShippingOnly,C=e.isPickupOnly,A=e.hasGiftOption,E=e.hasShipByDate,j=e.shipByDate,D=e.toggleGiftOption,I=e.setShipByDate,M=e.customerMessage,w=this.state,F=w.isResettingAddress,N=w.isUpdatingShippingData,P=w.hasRequestedShippingOptions,z=!["amazon","amazonpay"].some((function(e){return e===d}));return r.a.createElement(k.a,{autoComplete:"on"},r.a.createElement(K.a,null,r.a.createElement(De,{addresses:i,consignments:g,countries:l,countriesWithAutocomplete:u,deinitialize:b,formFields:this.getFields(O&&O.countryCode),googleMapsApiKey:p,hasRequestedShippingOptions:P,initialize:f,isLoading:F,isShippingStepPending:v,methodId:d,onAddressSelect:this.handleAddressSelect,onFieldChange:this.handleFieldChange,onUnhandledError:o,onUseNewAddress:this.onUseNewAddress,shippingAddress:h,shouldShowSaveAddress:c,isMessengerDelivery:y,isPickupOnly:C}),!C&&z&&r.a.createElement("div",{className:"form-body"},r.a.createElement(be,null))),r.a.createElement(ue,{isDatePicked:t,onDatePicked:n,cartHasChanged:s,isLoading:a||N,isMultiShippingMode:!1,shouldDisableSubmit:this.shouldDisableSubmit(),shouldShowOrderComments:m,shouldShowShippingOptions:S,isMessengerDelivery:y,isShippingOnly:_,isPickupOnly:C,hasGiftOption:A,hasShipByDate:E,shipByDate:j,toggleGiftOption:D,setShipByDate:I,customerMessage:M}))},t.prototype.updateAddressWithFormData=function(e){var t=this.props,n=t.shippingAddress,i=t.values.shippingAddress,s=i&&Object(d.a)(i);s&&!Object(c.a)(s,n)&&(this.setState({isUpdatingShippingData:!0}),this.debouncedUpdateAddress(s,e))},t.prototype.getFields=function(e){return(0,this.props.getFields)(e)},t.contextType=fe.a,t}(a.PureComponent),Fe=Object(v.a)(Object(y.withFormik)({handleSubmit:function(e,t){(0,t.props.onSubmit)(e)},mapPropsToValues:function(e){var t=e.getFields,n=e.shippingAddress;return{billingSameAsShipping:e.isBillingSameAsShipping,orderComment:e.customerMessage,shippingAddress:Object(ge.a)(t(n&&n.countryCode),n)}},isInitialValid:function(e){var t=e.shippingAddress,n=e.getFields,i=e.language;return!!t&&Object(M.a)({language:i,formFields:n(t.countryCode)}).isValidSync(t)},validationSchema:function(e){var t=e.language,n=e.getFields;return e.methodId?Object(C.object)({shippingAddress:Object(C.lazy)((function(e){return Object(me.a)({translate:Object(M.b)(t),formFields:n(e&&e.countryCode)})}))}):Object(C.object)({shippingAddress:Object(C.lazy)((function(e){return Object(M.a)({language:t,formFields:n(e&&e.countryCode)})}))})},enableReinitialize:!1})(we)),Ne=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Object(i.__extends)(t,e),t.prototype.render=function(){var e=this.props,t=e.isDatePicked,n=e.onDatePicked,i=e.addresses,s=e.assignItem,a=e.cart,o=e.cartHasChanged,d=e.createCustomerAddress,c=e.consignments,l=e.countries,u=e.countriesWithAutocomplete,p=e.onCreateAccount,h=e.customerMessage,g=e.deinitialize,m=e.deleteConsignments,f=e.getFields,S=e.googleMapsApiKey,b=e.initialize,O=e.isBillingSameAsShipping,v=e.isGuest,y=e.isLoading,_=e.isMultiShippingMode,C=e.methodId,A=e.onMultiShippingSubmit,E=e.onSignIn,j=e.onSingleShippingSubmit,k=e.onUnhandledError,D=e.onUseNewAddress,I=e.shippingAddress,M=e.shouldShowOrderComments,w=e.shouldShowSaveAddress,F=e.shouldShowAddAddressInCheckout,N=e.signOut,P=e.updateAddress,z=e.isShippingStepPending,B=e.isMessengerDelivery,U=e.isShippingOnly,L=e.isPickupOnly,x=e.hasGiftOption,G=e.hasShipByDate,T=e.shipByDate,R=e.toggleGiftOption,V=e.setShipByDate;return _?r.a.createElement(he,{isDatePicked:t,onDatePicked:n,addresses:i,assignItem:s,cart:a,cartHasChanged:o,consignments:c,countries:l,countriesWithAutocomplete:u,createCustomerAddress:d,customerMessage:h,defaultCountryCode:null==I?void 0:I.countryCode,getFields:f,googleMapsApiKey:S,isGuest:v,isLoading:y,onCreateAccount:p,onSignIn:E,onSubmit:A,onUnhandledError:k,onUseNewAddress:D,shouldShowAddAddressInCheckout:F,shouldShowOrderComments:M,isMessengerDelivery:B,isShippingOnly:U,isPickupOnly:L,hasGiftOption:x,hasShipByDate:G,shipByDate:T,toggleGiftOption:R,setShipByDate:V}):r.a.createElement(Fe,{isDatePicked:t,onDatePicked:n,addresses:i,cartHasChanged:o,consignments:c,countries:l,countriesWithAutocomplete:u,customerMessage:h,deinitialize:g,deleteConsignments:m,getFields:f,googleMapsApiKey:S,initialize:b,isBillingSameAsShipping:O,isLoading:y,isMultiShippingMode:_,isShippingStepPending:z,methodId:C,onSubmit:j,onUnhandledError:k,shippingAddress:I,shouldShowOrderComments:M,shouldShowSaveAddress:w,signOut:N,updateAddress:P,isMessengerDelivery:B,isShippingOnly:U,isPickupOnly:L,hasGiftOption:x,hasShipByDate:G,shipByDate:T,toggleGiftOption:R,setShipByDate:V})},t}(a.Component),Pe=Object(v.a)(Ne),ze=Object(a.memo)((function(e){var t=e.isMultiShippingMode,n=e.isGuest,i=e.onMultiShippingChange,s=e.shouldShowMultiShipping;return r.a.createElement("div",{className:"form-legend-container"},r.a.createElement(H.a,{testId:"shipping-address-heading"},r.a.createElement(E.a,{id:t?n?"shipping.multishipping_address_heading_guest":"shipping.multishipping_address_heading":"shipping.shipping_address_heading"})),s&&r.a.createElement("a",{"data-test":"shipping-mode-toggle",href:"#",onClick:Object(A.a)(i)},r.a.createElement(E.a,{id:t?"shipping.ship_to_single":"shipping.ship_to_multi"})))})),Be=function(e){function t(t){var n=e.call(this,t)||this;return n.handleDatePicked=function(){n.setState({isDatePicked:!0})},n.handleMultiShippingModeSwitch=function(){return Object(i.__awaiter)(n,void 0,void 0,(function(){var e,t,n,a,r,o,d,c,l;return Object(i.__generator)(this,(function(i){switch(i.label){case 0:if(e=this.props,t=e.consignments,n=e.isMultiShippingMode,a=e.onToggleMultiShipping,r=void 0===a?s.noop:a,o=e.onUnhandledError,d=void 0===o?s.noop:o,c=e.updateShippingAddress,!(n&&t.length>1))return[3,5];this.setState({isInitializing:!0}),i.label=1;case 1:return i.trys.push([1,3,4,5]),[4,c(t[0].shippingAddress)];case 2:return i.sent(),[3,5];case 3:return l=i.sent(),d(l),[3,5];case 4:return this.setState({isInitializing:!1}),[7];case 5:return r(),[2]}}))}))},n.handleSingleShippingSubmit=function(e){var t=e.billingSameAsShipping,s=e.shippingAddress,a=e.orderComment;return Object(i.__awaiter)(n,void 0,void 0,(function(){var e,n,r,o,l,u,p,h,g,m,f,S,b,O,v,y,_,C,A;return Object(i.__generator)(this,(function(i){switch(i.label){case 0:e=this.props,n=e.customerMessage,r=e.updateCheckout,o=e.updateShippingAddress,l=e.updateBillingAddress,u=e.navigateNextStep,p=e.onUnhandledError,h=e.shippingAddress,g=e.billingAddress,m=e.methodId,f=e.hasGiftOption,S=e.hasShipByDate,b=e.shipByDate,O=s&&Object(d.a)(s),v=[],y=this.hasRemoteBilling(m),Object(c.a)(O,h)||v.push(o(O||{})),t&&O&&!Object(c.a)(O,g)&&!y&&v.push(l(O)),console.log("orderComment",a),_=a.replace(/(\[[\s\S]+\] +)/,""),n!==(C=(f?"[This is a Gift] ":"")+(S?"[Delivery Date: "+b+"] ":"")+_)&&v.push(r({customerMessage:C})),i.label=1;case 1:return i.trys.push([1,3,,4]),[4,Promise.all(v)];case 2:return i.sent(),u(t),[3,4];case 3:return A=i.sent(),p(A),[3,4];case 4:return[2]}}))}))},n.hasRemoteBilling=function(e){return["amazonpay"].some((function(t){return t===e}))},n.handleUseNewAddress=function(e,t){return Object(i.__awaiter)(n,void 0,void 0,(function(){var n,s,a,r;return Object(i.__generator)(this,(function(i){switch(i.label){case 0:n=this.props,s=n.unassignItem,a=n.onUnhandledError,i.label=1;case 1:return i.trys.push([1,3,,4]),[4,s({shippingAddress:e,lineItems:[{quantity:1,itemId:t}]})];case 2:return i.sent(),location.href="/account.php?action=add_shipping_address&from=checkout",[3,4];case 3:return r=i.sent(),a(new f(r)),[3,4];case 4:return[2]}}))}))},n.handleMultiShippingSubmit=function(e){var t=e.orderComment;return Object(i.__awaiter)(n,void 0,void 0,(function(){var e,n,s,a,r,o;return Object(i.__generator)(this,(function(i){switch(i.label){case 0:e=this.props,n=e.customerMessage,s=e.updateCheckout,a=e.navigateNextStep,r=e.onUnhandledError,i.label=1;case 1:return i.trys.push([1,4,,5]),n===t?[3,3]:[4,s({customerMessage:t})];case 2:i.sent(),i.label=3;case 3:return a(!1),[3,5];case 4:return o=i.sent(),r(o),[3,5];case 5:return[2]}}))}))},n.state={isInitializing:!0,isDatePicked:""!==n.props.shipByDate},n}return Object(i.__extends)(t,e),t.prototype.componentDidMount=function(){return Object(i.__awaiter)(this,void 0,void 0,(function(){var e,t,n,a,r,o,d,c;return Object(i.__generator)(this,(function(i){switch(i.label){case 0:e=this.props,t=e.loadShippingAddressFields,n=e.loadShippingOptions,a=e.onReady,r=void 0===a?s.noop:a,o=e.onUnhandledError,d=void 0===o?s.noop:o,i.label=1;case 1:return i.trys.push([1,3,4,5]),[4,Promise.all([t(),n()])];case 2:return i.sent(),r(),[3,5];case 3:return c=i.sent(),d(c),[3,5];case 4:return this.setState({isInitializing:!1}),[7];case 5:return[2]}}))}))},t.prototype.render=function(){var e=this.props,t=e.isBillingSameAsShipping,n=e.isGuest,s=e.shouldShowMultiShipping,a=e.customer,o=(e.unassignItem,e.updateShippingAddress),d=e.initializeShippingMethod,c=e.deinitializeShippingMethod,l=e.isMultiShippingMode,u=(e.onToggleMultiShipping,e.isMessengerDelivery),h=e.isShippingOnly,g=e.isPickupOnly,m=e.hasGiftOption,f=e.hasShipByDate,S=e.shipByDate,b=e.toggleGiftOption,O=e.setShipByDate,v=Object(i.__rest)(e,["isBillingSameAsShipping","isGuest","shouldShowMultiShipping","customer","unassignItem","updateShippingAddress","initializeShippingMethod","deinitializeShippingMethod","isMultiShippingMode","onToggleMultiShipping","isMessengerDelivery","isShippingOnly","isPickupOnly","hasGiftOption","hasShipByDate","shipByDate","toggleGiftOption","setShipByDate"]),y=this.state,_=y.isInitializing,C=y.isDatePicked;return r.a.createElement("div",{className:"checkout-form"},r.a.createElement(ze,{isGuest:n,isMultiShippingMode:l,onMultiShippingChange:this.handleMultiShippingModeSwitch,shouldShowMultiShipping:s}),r.a.createElement(p.a,{isLoading:_,unmountContentWhenLoading:!0},r.a.createElement(Pe,Object(i.__assign)({},v,{addresses:a.addresses,deinitialize:c,initialize:d,isBillingSameAsShipping:t,isGuest:n,isMultiShippingMode:l,onMultiShippingSubmit:this.handleMultiShippingSubmit,onSingleShippingSubmit:this.handleSingleShippingSubmit,onUseNewAddress:this.handleUseNewAddress,shouldShowSaveAddress:!n,updateAddress:o,isDatePicked:C,onDatePicked:this.handleDatePicked,isMessengerDelivery:u,isShippingOnly:h,isPickupOnly:g,hasGiftOption:m,hasShipByDate:f,shipByDate:S,toggleGiftOption:b,setShipByDate:O}))))},t}(a.Component),Ue=Object(o.createSelector)((function(e){return e.checkoutService.deleteConsignment}),(function(e){return e.checkoutState.data.getConsignments()}),(function(e,t){return function(){return Object(i.__awaiter)(void 0,void 0,void 0,(function(){return Object(i.__generator)(this,(function(n){switch(n.label){case 0:return t&&t.length?[4,Promise.all(t.map((function(t){var n=t.id;return e(n)})))]:[2];case 1:return[2,n.sent()[0].data.getShippingAddress()]}}))}))}}));function Le(e){var t=e.checkoutService,n=e.checkoutState,i=n.data,s=i.getCart,a=i.getCheckout,r=i.getConfig,o=i.getCustomer,d=i.getConsignments,c=i.getShippingAddress,l=i.getBillingAddress,p=i.getShippingAddressFields,h=i.getShippingCountries,g=n.statuses,m=g.isShippingStepPending,f=g.isSelectingShippingOption,b=g.isLoadingShippingOptions,v=g.isUpdatingConsignment,y=g.isCreatingConsignments,_=g.isCreatingCustomerAddress,C=g.isLoadingShippingCountries,A=g.isUpdatingBillingAddress,E=g.isUpdatingCheckout,j=a(),k=r(),D=d()||[],I=o(),M=s();if(!(j&&k&&I&&M))return null;var w=k.checkoutSettings,F=w.enableOrderComments,N=w.features,P=w.hasMultiShippingEnabled,z=w.googleMapsApiKey,B=O(j),U=Object(S.a)(M),L=b()||f()||v()||y()||A()||E()||_(),x=P&&!B&&U>1&&U<50,G=["US","CA","AU","NZ"];N["CHECKOUT-4183.checkout_google_address_autocomplete_uk"]&&G.push("GB");var T=!x&&D.length>1?void 0:c();return{assignItem:t.assignItemsToAddress,billingAddress:l(),cart:M,consignments:D,countries:h()||u.a,countriesWithAutocomplete:G,customer:I,customerMessage:j.customerMessage,createCustomerAddress:t.createCustomerAddress,deinitializeShippingMethod:t.deinitializeShipping,deleteConsignments:Ue({checkoutService:t,checkoutState:n}),getFields:p,googleMapsApiKey:z,initializeShippingMethod:t.initializeShipping,isGuest:I.isGuest,isInitializing:C()||b(),isLoading:L,isShippingStepPending:m(),loadShippingAddressFields:t.loadShippingAddressFields,loadShippingOptions:t.loadShippingOptions,methodId:B,shippingAddress:T,shouldShowMultiShipping:x,shouldShowAddAddressInCheckout:N["CHECKOUT-4726.add_address_in_multishipping_checkout"],shouldShowOrderComments:F,signOut:t.signOutCustomer,unassignItem:t.unassignItemsToAddress,updateBillingAddress:t.updateBillingAddress,updateCheckout:t.updateCheckout,updateShippingAddress:t.updateShippingAddress}}t.default=Object(l.a)(Le)(Be)}}]);
//# sourceMappingURL=shipping-0b0d326c.js.map